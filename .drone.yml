---
kind: pipeline
type: docker
name: default

steps:
- name: build
  image: node
  commands:
  - npm install --prefix ./frontend
  - npm run --prefix ./frontend dev

- name: test
  image: python
  commands:
  - pip install -r requirements.txt
  - python manage.py test

- name: deploy
  image: plugins/webhook
  settings:
    signature_secret:
      from_secret: webhook_secret
    urls: https://webhook.ltn.fi/hooks/radiodns
  when:
    branch:
    - main
    status:
    - success